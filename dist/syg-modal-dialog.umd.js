(function(M,y){typeof exports=="object"&&typeof module<"u"?y(exports):typeof define=="function"&&define.amd?define(["exports"],y):(M=typeof globalThis<"u"?globalThis:M||self,y(M.SygModalDialog={}))})(this,(function(M){"use strict";const H=class H{constructor(t={}){this.options={...H.defaultOptions,...t},this.dialog=this.createDialog(),this.container=this.dialog.querySelector("#syg-modal-container"),this.content=this.dialog.querySelector("#syg-modal-content"),this.loading=this.dialog.querySelector("#syg-modal-loading"),this.setupEventListeners()}createDialog(){const t=document.createElement("dialog");t.id="syg-modal-dialog",t.className=this.options.modalClass;const n=document.createElement("div");n.id="syg-modal-container",n.className=this.options.containerClass;const e=document.createElement("div");e.id="syg-modal-content",e.className=this.options.contentClass;const r=document.createElement("form");r.method="dialog";const a=document.createElement("button");a.type="submit",a.className=this.options.closeBtnClass,a.innerHTML=this.options.closeButtonContent,r.appendChild(a);const s=document.createElement("div");return s.id="syg-modal-loading",s.className=this.options.loadingClass,s.setAttribute("data-state","init"),s.innerHTML=this.options.loadingContent,n.appendChild(e),t.appendChild(n),t.appendChild(r),t.appendChild(s),t}setupEventListeners(){this.dialog.addEventListener("click",t=>{t.target===this.dialog&&this.close()}),this.dialog.addEventListener("close",()=>{document.documentElement.style.overflow="",document.documentElement.style.height="",this.options.onClose&&this.options.onClose()})}open(){this.dialog.parentElement||document.body.appendChild(this.dialog),this.dialog.showModal(),document.documentElement.style.overflow="hidden",document.documentElement.style.height="100vh",this.options.onOpen&&this.options.onOpen()}close(){this.dialog.close()}setContent(t){this.content.innerHTML=t}setLoadingState(t){this.loading.setAttribute("data-state",t)}setType(t){this.dialog.setAttribute("data-syg-modal-type",t),t==="ajax"||t==="selector"?this.content.className=this.options.contentClass:this.content.className=""}getDialog(){return this.dialog}getContainer(){return this.container}getContent(){return this.content}getLoading(){return this.loading}isOpen(){return this.dialog.open}destroy(){this.dialog.parentElement&&this.dialog.remove()}};H.defaultOptions={closeButtonContent:"×",loadingContent:"",modalClass:"c-modal",containerClass:"c-modal__container",contentClass:"c-modal__content",closeBtnClass:"c-modal__close-btn",loadingClass:"c-modal__loading"};let y=H;async function J(c,t){const n=K(c);if(!n)throw new Error("YouTube動画IDを取得できませんでした");const e=document.createElement("iframe");e.src=`https://www.youtube.com/embed/${n}?autoplay=1`,e.width="560",e.height="315",e.allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",e.allowFullscreen=!0,e.style.maxWidth="100%",t.innerHTML="",t.appendChild(e)}function K(c){let t=c.match(/[?&]v=([^&]+)/);return t!=null&&t[1]||(t=c.match(/youtu\.be\/([^?&]+)/),t!=null&&t[1])||(t=c.match(/youtube\.com\/embed\/([^?&]+)/),t!=null&&t[1])?t[1]:null}async function Q(c,t,n,e){return new Promise((r,a)=>{const s=document.createElement("img");s.style.cursor="pointer",s.onload=()=>{const l=s.naturalWidth,d=s.naturalHeight,m=n.clientWidth,b=n.clientHeight,A=l/d,nt=m/b;let v,T;A>nt?(v=Math.min(m,l),T=v/A):(T=Math.min(b,d),v=T*A),e.style.width=`${v}px`,e.style.height=`${T}px`,e.style.left=`${(m-v)/2}px`,e.style.top=`${(b-T)/2}px`,e.style.transformOrigin="0 0";let g=!1,w=0,L=0,D=1,C=!1,U=0,Y=0,O=0,R=0,x=0,S=0,h=null,X=0,$=0,j=0;const W=()=>{e.style.transform=`matrix(${D}, 0, 0, ${D}, ${w}, ${L})`},q=()=>{w=X,L=$,W(),h=null},F=o=>{Date.now()-j<500||o.target!==e&&o.target!==s||(C=!0,O=o.clientX,R=o.clientY,U=o.clientX,Y=o.clientY,x=w,S=L,e.style.cursor=g?"grabbing":"pointer")},B=o=>{if(o.target!==e&&o.target!==s||o.touches.length!==1)return;j=Date.now(),o.preventDefault();const i=o.touches[0];i&&(C=!0,O=i.clientX,R=i.clientY,U=i.clientX,Y=i.clientY,x=w,S=L)},z=o=>{if(!C)return;const i=o.clientX-U,u=o.clientY-Y;g&&(X=x+i,$=S+u,h===null&&(h=requestAnimationFrame(q)))},P=o=>{if(!C||o.touches.length!==1)return;const i=o.touches[0];if(!i)return;const u=i.clientX-U,I=i.clientY-Y;g&&(o.preventDefault(),X=x+u,$=S+I,h===null&&(h=requestAnimationFrame(q)))},ot=(o,i)=>{g=!0,D=l/v;const u=n.getBoundingClientRect(),I=o-u.left,f=i-u.top,p=parseFloat(e.style.left),it=parseFloat(e.style.top),rt=I-p,at=f-it;w=rt*(1-D),L=at*(1-D),e.style.cursor="grab",W()},st=()=>{g=!1,D=1,w=0,L=0,e.style.cursor="pointer",W()},Z=(o,i)=>{if(!C)return;h!==null&&(cancelAnimationFrame(h),h=null),Math.sqrt(Math.pow(o-O,2)+Math.pow(i-R,2))<5?g?st():ot(o,i):(w=X,L=$),C=!1,g&&(e.style.cursor="grab")},_=o=>{Z(o.clientX,o.clientY)},G=()=>{if(g)return;const o=n.clientWidth,i=n.clientHeight,u=l/d,I=o/i;let f,p;u>I?(f=Math.min(o,l),p=f/u):(p=Math.min(i,d),f=p*u),e.style.width=`${f}px`,e.style.height=`${p}px`,e.style.left=`${(o-f)/2}px`,e.style.top=`${(i-p)/2}px`,v=f,T=p},N=o=>{if(!C)return;o.preventDefault();const i=o.changedTouches[0];i&&Z(i.clientX,i.clientY)};e.addEventListener("mousedown",F),e.addEventListener("touchstart",B,{passive:!1}),document.addEventListener("mousemove",z),document.addEventListener("touchmove",P,{passive:!1}),document.addEventListener("mouseup",_),document.addEventListener("touchend",N),document.addEventListener("touchcancel",N),window.addEventListener("resize",G),t.innerHTML="",t.appendChild(s),r({startDrag:F,doDrag:z,endDrag:_,touchStart:B,touchMove:P,touchEnd:N,onResizeHandler:G,rafId:h})},s.onerror=()=>a(new Error("画像の読み込みに失敗しました")),s.src=c})}async function V(c,t){const n=await fetch(c);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const e=await n.text();t.innerHTML=e}function tt(c,t){const n=document.querySelector(c);if(!n)throw new Error(`要素が見つかりません: ${c}`);t.innerHTML=n.innerHTML}function et(c,t){t.innerHTML=c}const E=class E{static bind(t,n={}){this.boundSelectors.has(t)||(this.boundSelectors.add(t),this.delegateListener||(this.delegateListener=e=>{const r=e.target;for(const a of this.boundSelectors){const s=r.closest(a);if(s){e.preventDefault();let l=s.getAttribute("data-syg-modal-src");if(!l&&s.tagName==="A"){const b=s;l=b.getAttribute("href")||b.href}const d=s.getAttribute("data-syg-modal"),m=d&&d!==""?d:void 0;if(!l){console.error("data-syg-modal-src または href が指定されていません");return}this.showModal({...n,src:l,type:m});break}}},document.addEventListener("click",this.delegateListener)))}static showModal(t){const{src:n,type:e,html:r}=t;if(e==="html"){if(!r){console.error('type="html"の場合、htmlプロパティが必要です');return}}else if(!n){console.error("srcが指定されていません");return}const a=e||(n?this.detectType(n):null);if(!a){console.error("コンテンツタイプが判別できません");return}if(this.currentModalUI&&this.currentModalUI.isOpen()){this.updateContent(n||"",t);return}this.currentModalUI=new y({...t,onClose:()=>{this.cleanupImageDragListeners(),t.onClose&&t.onClose(),this.currentModalUI&&(this.currentModalUI.destroy(),this.currentModalUI=null)}}),this.currentModalUI.setType(a),this.currentModalUI.open(),this.loadContent(n||"",a,t)}static detectType(t){return/^https?:\/\/(www\.)?(youtube\.com|youtu\.be)\//.test(t)?"youtube":/^[.#]/.test(t)?"selector":/\.(jpe?g|png|gif|webp)$/i.test(t)?"image":/^https?:\/\//.test(t)?"ajax":null}static cleanupImageDragListeners(){if(!this.imageDragListeners)return;const{doDrag:t,endDrag:n,startDrag:e,touchStart:r,touchMove:a,touchEnd:s,onResizeHandler:l,rafId:d}=this.imageDragListeners;if(d!=null&&cancelAnimationFrame(d),this.currentModalUI){const m=this.currentModalUI.getContainer();m.removeEventListener("mousedown",e),m.removeEventListener("touchstart",r)}document.removeEventListener("mousemove",t),document.removeEventListener("touchmove",a),document.removeEventListener("mouseup",n),document.removeEventListener("touchend",s),document.removeEventListener("touchcancel",s),window.removeEventListener("resize",l),this.imageDragListeners=null}static async loadContent(t,n,e){if(!this.currentModalUI)return;const r=this.currentModalUI.getContent(),a=this.currentModalUI.getDialog(),s=this.currentModalUI.getContainer();r.innerHTML="",this.currentModalUI.setLoadingState("loading");try{switch(n){case"youtube":await J(t,r);break;case"image":this.imageDragListeners=await Q(t,r,a,s);break;case"ajax":await V(t,r);break;case"selector":tt(t,r);break;case"html":const l=(e==null?void 0:e.html)||t;et(l,r);break}this.currentModalUI.setLoadingState("complete")}catch(l){console.error("コンテンツの読み込みに失敗しました:",l),r.innerHTML="<p>コンテンツの取得に失敗しました</p>",this.currentModalUI.setLoadingState("complete")}}static updateContent(t,n){if(!this.currentModalUI)return;const e=n.type||this.detectType(t);if(!e){console.error("コンテンツタイプが判別できません:",t);return}this.currentModalUI.setType(e),this.loadContent(t,e,n)}};E.currentModalUI=null,E.boundSelectors=new Set,E.delegateListener=null,E.imageDragListeners=null;let k=E;M.SygModalDialog=k,Object.defineProperty(M,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=syg-modal-dialog.umd.js.map
